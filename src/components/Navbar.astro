---
import { url } from "../utils/url"

const links = [
  { href: url("#sobre-mi"), label: "Sobre mí" },
  { href: url("#proyectos"), label: "Proyectos" },
  { href: url("#experiencia"), label: "Experiencia" },
  { href: url("#contacto"), label: "Contacto" },
  { href: url("blog"), label: "Blog" },
]
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-100 dark:bg-gray-950/80 dark:border-gray-800">
  <nav class="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">

    <!-- Logo + reloj -->
    <div class="flex items-center gap-4">
      <a href={url("")} class="text-sm font-semibold tracking-tight text-gray-900 hover:text-gray-600 transition-colors dark:text-gray-100 dark:hover:text-gray-400">
        jsalas.dev
      </a>
      <div class="hidden sm:flex items-center gap-1.5 px-3 py-1 bg-gray-50 border border-gray-100 rounded-full dark:bg-gray-900 dark:border-gray-800">
        <svg class="w-3 h-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <span id="clock" class="text-xs font-mono text-gray-400 tabular-nums">00:00:00</span>
      </div>

      <!-- Botón tema -->
      <button
        id="theme-toggle"
        class="p-2 rounded-full text-gray-400 hover:text-gray-700 hover:bg-gray-100 transition-colors dark:hover:text-gray-200 dark:hover:bg-gray-800"
        aria-label="Cambiar tema"
      >
        <svg id="icon-sun" class="w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg id="icon-moon" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>

    <div class="flex items-center gap-4">
      <!-- Links desktop -->
      <ul class="hidden md:flex items-center gap-8">
        {links.map((link) => (
          <li>
            <a href={link.href} class="text-sm text-gray-500 hover:text-gray-900 transition-colors dark:hover:text-gray-100">
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Botón hamburguesa -->
      <button id="menu-toggle" class="md:hidden p-2 rounded-lg text-gray-500 hover:text-gray-900 hover:bg-gray-100 transition-colors dark:hover:bg-gray-800 dark:hover:text-gray-100">
        <svg id="icon-open" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <svg id="icon-close" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

  </nav>

  <!-- Menú móvil desplegable -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 bg-white/95 backdrop-blur-sm dark:bg-gray-950/95 dark:border-gray-800">
    <ul class="max-w-5xl mx-auto px-6 py-4 flex flex-col gap-1">
      {links.map((link) => (
        <li>
          <a
            href={link.href}
            class="mobile-link block py-2.5 px-3 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors dark:text-gray-400 dark:hover:text-gray-100 dark:hover:bg-gray-800"
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  // Reloj
  function updateClock() {
    const clock = document.getElementById("clock")
    if (!clock) return
    const now = new Date().toLocaleTimeString("es-ES", {
      timeZone: "Atlantic/Canary",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: false,
    })
    clock.textContent = now
  }
  updateClock()
  setInterval(updateClock, 1000)

  // Tema
  function applyTheme(dark: boolean) {
    document.documentElement.classList.toggle("dark", dark)
    const iconSun = document.getElementById("icon-sun") as HTMLElement
    const iconMoon = document.getElementById("icon-moon") as HTMLElement
    iconSun?.classList.toggle("hidden", !dark)
    iconMoon?.classList.toggle("hidden", dark)
    localStorage.setItem("theme", dark ? "dark" : "light")
  }

  applyTheme(localStorage.getItem("theme") === "dark")

  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement
    if (target.closest("#theme-toggle")) {
      const currentlyDark = document.documentElement.classList.contains("dark")
      applyTheme(!currentlyDark)
    }
  })

  // Menú móvil
  function initNavbar() {
    const menuToggle = document.getElementById("menu-toggle")
    const mobileMenu = document.getElementById("mobile-menu")
    const iconOpen = document.getElementById("icon-open")
    const iconClose = document.getElementById("icon-close")

    if (menuToggle) {
      menuToggle.onclick = () => {
        const isOpen = !mobileMenu?.classList.contains("hidden")
        mobileMenu?.classList.toggle("hidden", isOpen)
        iconOpen?.classList.toggle("hidden", !isOpen)
        iconClose?.classList.toggle("hidden", isOpen)
      }
    }

    document.querySelectorAll(".mobile-link").forEach(link => {
      (link as HTMLElement).onclick = () => {
        mobileMenu?.classList.add("hidden")
        iconOpen?.classList.remove("hidden")
        iconClose?.classList.add("hidden")
      }
    })
  }

  initNavbar()
  document.addEventListener("astro:page-load", () => {
    applyTheme(localStorage.getItem("theme") === "dark")
    initNavbar()
  })
</script>