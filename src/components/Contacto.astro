---
const WEB3FORMS_KEY = import.meta.env.PUBLIC_WEB3FORMS_KEY
---

<section id="contacto" class="py-24 border-t border-gray-100 dark:border-gray-800">
  <div class="max-w-5xl mx-auto px-6">

    <p class="reveal text-sm font-medium text-gray-400 uppercase tracking-widest mb-12">
      Contacto
    </p>

    <div class="grid md:grid-cols-2 gap-16">

      <!-- Texto izquierda -->
      <div class="reveal">
        <p class="text-2xl font-medium text-gray-900 leading-snug mb-4 dark:text-gray-100">
          ¿Necesitas ponerte en contacto conmigo?
        </p>
        <p class="text-gray-500 leading-relaxed dark:text-gray-400">
          Rellena el siguiente formulario con tus datos y te intentaré responder
          en el menor tiempo posible.
        </p>
      </div>

      <!-- Formulario derecha -->
      <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" class="reveal reveal-delay-1 space-y-4">
        
        <input type="hidden" name="access_key" value={WEB3FORMS_KEY} />
        <input type="hidden" name="redirect" value="false" />

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300">Nombre</label>
          <input
            type="text"
            name="name"
            required
            class="w-full px-4 py-2.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:border-gray-400 transition-colors dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100 dark:placeholder-gray-500 dark:focus:border-gray-500"
            placeholder="Tu nombre"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300">Email</label>
          <input
            type="email"
            name="email"
            required
            class="w-full px-4 py-2.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:border-gray-400 transition-colors dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100 dark:placeholder-gray-500 dark:focus:border-gray-500"
            placeholder="tu@email.com"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-300">Mensaje</label>
          <textarea
            name="message"
            required
            rows="4"
            class="w-full px-4 py-2.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:border-gray-400 transition-colors resize-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-100 dark:placeholder-gray-500 dark:focus:border-gray-500"
            placeholder="Escribe tu mensaje aquí..."
          ></textarea>
        </div>

        <button
          type="submit"
          class="w-full px-6 py-3 bg-gray-900 text-white text-sm font-medium rounded-full hover:bg-gray-700 transition-colors dark:bg-white dark:text-gray-900 dark:hover:bg-gray-200"
        >
          Enviar mensaje
        </button>

        <p id="form-result" class="text-sm text-center hidden"></p>

      </form>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("contact-form") as HTMLFormElement
  const result = document.getElementById("form-result")

  form.addEventListener("submit", async (e) => {
    e.preventDefault()

    const btn = form.querySelector("button[type=submit]") as HTMLButtonElement
    btn.textContent = "Enviando..."
    btn.disabled = true

    const formData = new FormData(form)
    const response = await fetch("https://api.web3forms.com/submit", {
      method: "POST",
      body: formData,
    })

    const data = await response.json()

    if (data.success) {
      result!.textContent = "Mensaje enviado. ¡Te respondo pronto!"
      result!.classList.remove("hidden", "text-red-500")
      result!.classList.add("text-green-600")
      form!.reset()
    } else {
      result!.textContent = "Algo salió mal. Inténtalo de nuevo."
      result!.classList.remove("hidden", "text-green-600")
      result!.classList.add("text-red-500")
    }

    btn.textContent = "Enviar mensaje"
    btn.disabled = false
  })
</script>